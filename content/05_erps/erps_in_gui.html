<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HNN Textbook</title>
    <!-- <base href="/website_redesign/"> -->
    <link href="https://fonts.googleapis.com/css2?family=Fira+Sans:wght@400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../assets/styles.css">
</head>
<body>

	<div id="mySidebar" class="sidebar">
		<div class="navbar-header">
		<a>
			Human Neocortical Neurosolver
		</a>
		<br>
			<svg class="collapse-icon" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
				<path d="M9 9H4v1h5V9z"/>
				<path fill-rule="evenodd" clip-rule="evenodd" d="M5 3l1-1h7l1 1v7l-1 1h-2v2l-1 1H3l-1-1V6l1-1h2V3zm1 2h4l1 1v4h2V3H6v2zm4 1H3v7h7V6z"/>
			</svg>
		</div>
		<a href="/website_redesign/content/preface.html">Preface</a>
		<div class="sidebar-list">
			<a id="sidebar-header" onclick="toggleSubmenu(event)">
		<span class="toggle-icon">+</span>
				1. Overview
			</a>
			<div class="submenu">
				<a href="/website_redesign/content/01_overview/challange.html">1.1 Challenge in Connecting EEG MEG to Neural Circuits </a>
				<a href="/website_redesign/content/01_overview/using_hnn.html">1.2 How HNN solve the Challenge by Bridging Scales</a>
				<a href="/website_redesign/content/01_overview/sample_workflow.html">1.3 Overview of the Simulation Workflow</a>
			</div>
		</div>
		<div class="sidebar-list">
			<a id="sidebar-header" onclick="toggleSubmenu(event)">
		<span class="toggle-icon">+</span>
				2. Background
			</a>
			<div class="submenu">
				<a href="/website_redesign/content/02_background/biophysical_modeling.html">2.1 Challenge in Connecting EEG MEG to Neural Circuits </a>
				<a href="/website_redesign/content/02_background/signal_origins.html">2.2 The Origins of Source Localize MEG/EEG Primary Currents</a>
				<a href="/website_redesign/content/02_background/glossary.html">2.3 Glossary of Terms</a>
			</div>
		</div>
		<div class="sidebar-list">
			<a id="sidebar-header" onclick="toggleSubmenu(event)">
		<span class="toggle-icon">+</span>
				3. Assumptions and Validation
			</a>
			<div class="submenu">
				<a href="/website_redesign/content/03_assumptions/template_model.html">3.1 Template Model</a>
				<a href="/website_redesign/content/03_assumptions/cortical_column_structure.html">3.2 Cortical Column Structure</a>
				<a href="/website_redesign/content/03_assumptions/primary_electric_currents.html">3.3 Primary Electrical Currents</a>
				<a href="/website_redesign/content/03_assumptions/neurons_morphology_and_physiology.html">3.4 Neurons: Morphology and Physiology</a>
				<a href="/website_redesign/content/03_assumptions/synaptic_connectivity.html">3.5 Synaptic Connectivity</a>
				<a href="/website_redesign/content/03_assumptions/evoked_and_rhythmic_driving_inputs.html">3.6 Evoked and Rhythmic Driving Inputs</a>
				<a href="/website_redesign/content/03_assumptions/tonic_and_noisy_driving_inputs.html">3.7 Tonic and Noisy Driving Inputs</a>
			</div>
		</div>
		<div class="sidebar-list">
			<a id="sidebar-header" onclick="toggleSubmenu(event)">
		<span class="toggle-icon">+</span>
				4. Using HNN
			</a>
			<div class="submenu">
				<a href="/website_redesign/content/04_using_hnn/installation.html">4.1 Installation</a>
				<a href="/website_redesign/content/04_using_hnn/network_parameters.html">4.2 Network Parameters</a>
				<a href="/website_redesign/content/04_using_hnn/drive_parameters.html">4.3 Drive Parameters</a>
				<a href="/website_redesign/content/04_using_hnn/loading_data.html">4.4 Loading Data</a>
				<a href="/website_redesign/content/04_using_hnn/running_simulations.html">4.5 Running Simulations</a>
				<a href="/website_redesign/content/04_using_hnn/plotting_firing_patterns.html">4.6 Plotting Firing Patterns</a>
				<a href="/website_redesign/content/04_using_hnn/recording_lfp.html">4.7 Recording and Plotting LFP</a>
				<a href="/website_redesign/content/04_using_hnn/animating_simulations.html">4.8 Animating Simulations</a>
				<a href="/website_redesign/content/04_using_hnn/more_visualizations.html">4.9 Additional Visualizations</a>
				<a href="/website_redesign/content/04_using_hnn/parallelizing.html">4.10 Running Parallel Simulations</a>
				<a href="/website_redesign/content/04_using_hnn/optimization.html">4.11 Optimizing Evoked Responses and Rhythms</a>
				<a href="/website_redesign/content/04_using_hnn/batch_simulation.html">4.12 Running Batch Simulations</a>
			</div>
		</div>
		<div class="sidebar-list">
			<a id="sidebar-header" onclick="toggleSubmenu(event)">
		<span class="toggle-icon">+</span>
				5. Simulating ERPs
			</a>
			<div class="submenu">
				<a href="/website_redesign/content/05_erps/erps_in_gui.html">2.1 GUI Tutorial of ERP Simulation</a>
				<a href="/website_redesign/content/05_erps/hnn_core.html">2.2 API Tutorial of ERP Simulation</a>
			</div>
		</div>
		<div class="sidebar-list">
			<a id="sidebar-header" onclick="toggleSubmenu(event)">
		<span class="toggle-icon">+</span>
				6. Simulating Alpha/Beta Rhythms
			</a>
			<div class="submenu">
				<a href="/website_redesign/content/06_alpha_beta/gui.html">6.1 GUI Tutorial of Alpha/Beta Rhythms</a>
				<a href="/website_redesign/content/06_alpha_beta/api.html">6.2 API Tutorial of Alpha/Beta Rhythms</a>
			</div>
		</div>
		<div class="sidebar-list">
			<a id="sidebar-header" onclick="toggleSubmenu(event)">
		<span class="toggle-icon">+</span>
				7. Simulating Gamma Rhythms
			</a>
			<div class="submenu">
			</div>
		</div>
		<div class="sidebar-list">
			<a id="sidebar-header" onclick="toggleSubmenu(event)">
		<span class="toggle-icon">+</span>
				8. From Data to Simulation
			</a>
			<div class="submenu">
			</div>
		</div>
		<div class="sidebar-list">
			<a id="sidebar-header" onclick="toggleSubmenu(event)">
		<span class="toggle-icon">+</span>
				9. Feature Demos
			</a>
			<div class="submenu">
			</div>
		</div>
	</div>

<div id="main">
    <div class="topbar">

        <!-- Topbar menu -->
        <div class="menu-container">
            <div class="menu-icons">
                <button class="openbtn" onclick="toggleNav()">
                    ☰
                </button>
                <a href="" class="home-link">
                    <div class="home-icon-container">
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="24" 
                            height="24"
                            viewBox="0 0 24 24" 
                            class="home-icon">
                            <path
                                d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"
                            />
                        </svg>
                    </div>
                </a>
                <button class="theme-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                        <path d="M361.5 1.2c5 2.1 8.6 6.6 9.6 11.9L391 121l107.9 19.8c5.3 1 9.8 4.6 11.9 9.6s1.5 10.7-1.6 15.2L446.9 256l62.3 90.3c3.1 4.5 3.7 10.2 1.6 15.2s-6.6 8.6-11.9 9.6L391 391 371.1 498.9c-1 5.3-4.6 9.8-9.6 11.9s-10.7 1.5-15.2-1.6L256 446.9l-90.3 62.3c-4.5 3.1-10.2 3.7-15.2 1.6s-8.6-6.6-9.6-11.9L121 391 13.1 371.1c-5.3-1-9.8-4.6-11.9-9.6s-1.5-10.7 1.6-15.2L65.1 256 2.8 165.7c-3.1-4.5-3.7-10.2-1.6-15.2s6.6-8.6 11.9-9.6L121 121 140.9 13.1c1-5.3 4.6-9.8 9.6-11.9s10.7-1.5 15.2 1.6L256 65.1 346.3 2.8c4.5-3.1 10.2-3.7 15.2-1.6zM160 256a96 96 0 1 1 192 0 96 96 0 1 1 -192 0zm224 0a128 128 0 1 0 -256 0 128 128 0 1 0 256 0z"></path>
                    </svg>
                </button>
                <div class="dropdown">
                    <button 
                        id="dropdownButton" 
                        class="dropdown-button">
                            <img
                                src="/website_redesign/content/assets/icons/fontsize.png"
                                alt="fontsize"
                            />
                    </button>
                    <div class="dropdown-content">
                        <button 
                            class="fontsize-btn" 
                            onclick="decreaseFontSize()">
                            <img
                                src="/website_redesign/content/assets/icons/fontminus.png"
                                alt="fontminus"
                            />
                        </button>
                        <button 
                            class="fontsize-btn" 
                            onclick="increaseFontSize()">
                            <img
                                src="/website_redesign/content/assets/icons/fontplus.png"
                                alt="fontplus"
                            />
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Topbar image -->
        <img 
            id="topbar-logo"
            src="https://hnn.brown.edu/wp-content/uploads/hnn-medium.png"
        />

        <!-- Right side of topbar -->
        <div class="socials-container">
            <div class="social-icons">
                <a 
                    href="https://github.com/jonescompneurolab/hnn-core" 
                    target="_blank" 
                    aria-label="GitHub">
                    <img 
                        src="/website_redesign/content/assets/icons/github.png"
                        alt="GitHub">
                </a>
                <a 
                    href="https://bsky.app/profile/hnnsolver.bsky.social" 
                    target="_blank"
                    aria-label="BlueSky">
                    <img 
                        src="/website_redesign/content/assets/icons/bluesky.png"
                        alt="BlueSky">
                </a>
                <a 
                    href="https://www.linkedin.com/company/human-neocortical-neurosolver/" 
                    target="_blank"
                    aria-label="LinkedIn">
                    <img 
                        src="/website_redesign/content/assets/icons/linkedin.png"
                        alt="LinkedIn">
                </a>
            </div>
        </div>
    </div>

    <div id="content-wrapper">
    <div id="content">

<!--# Title: 2.1 GUI Tutorial of ERP Simulation# Updated: 2024-11-14## Contributors:    # Dylan Daniels--><h1>Event Related Potentials (ERPs)</h1><h2>Getting Started</h2><p>In order to understand the workflow and initial parameter setsprovided with this tutorial, we must first briefly describe priorstudies that led to the creation of the provided data and evokedresponse parameter set that you will work with. This tutorial is basedon results from our 2007 study where we recorded and simulated tactileevoked responses source localized to the primary somatosensory cortex(SI) [1].</p><p>In our 2007 study, we investigated the early evoked activity (0-175ms) elicited by a brief tap to the D3 digit and source localized to anan equivalent current dipole in the contralateral hand area of theprimary somatosensory cortex (SI) [1]. The strength of the tap was setat either suprathreshold (100% detection probability) or perceptualthreshold (50% detection) levels (see Figure 1, left panel below). Note,to be precise, this data represents source localized event related field(ERF) activity because it was collected using MEG. We use theterminology ERP for simplicity, since the primary current dipolesgenerating evoked fields and potentials are the same.</p><p>We found that we could reproduce evoked responses that accuratelyreflected the recorded waveform in our neocortical model from a layerspecific sequence of exogenous excitatory synaptic drive to the local SIcircuit, see Figure 1right panel below. This drive consisted of“feedforward” / proximal input at ~25 ms post-stimulus, followed by“feedback” / distal input at ~60 ms, followed by a subsequent“feedforward” / proximal input at ~125 ms (Gaussian distribution ofinput times on each simulated trial). This sequence of drive generatedspiking activity and intracellular dendritic current flow in thepyramidal neuron dendrites to reproduce the current dipole signal. Thissequence of drive can be interpreted as initial “feedforward” input fromthe lemniscal thalamus, followed by “feedback” input from higher ordercortex or non-lemniscal thalamus, followed by a re-emergent leminsicalthalamic drive. Intracranial recordings in non-human primates motivatedand supported this assumption [2].</p><p>In our model, the exogenous driving inputs were simulated aspredefined trains of action potentials (pre-synaptic spikes) thatactivated excitatory synapses in the local cortical circuit in proximaland distal projection patterns (i.e. feedforward, and feedback,respectively, as shown schematically in Figure 1 right, and in the HNNGUI Model Schematics). The number, timing and strength (post-synapticconductance) of the driving spikes were manually adjusted in the modeluntil a close representation of the data was found (all other modelparameters were tuned and fixed based on the morphology, physiology andconnectivity within layered neocortical circuits) [1]. Note, a scalingfactor was applied to net dipole output to match to the magnitude of therecorded ERP data and used to predict the number of neurons contributingto the recorded ERP (purple circle, Figure 1, right panel). The dipoleunits were in nAm, with a one-to-one comparison between data and modeloutput due to the biophysical detail in our model.</p><div style="display:block; width:100%; margin: 0 auto;"><figure><img src="images/erp_fig_01.png" alt="Figure 1" /><figcaption aria-hidden="true">Figure 1</figcaption></figure></div><p style="text-align:justify; display: block; margin: 0 auto;width: 90%; font-size: 1em;">Adapted from Jones et al. 2007 [1]. Comparison of SI evoked response inexperiment and neural model simulation. Left: MEG data showing tactileevoked response (ERP) source localized to the hand area of SI. Red:suprathreshold stimulation; Blue: Threshold stimulation (avg. n=100trials). Right: Neural model simulation depicting proximal/distal inputsneeded to replicate the ERP waveform (avg. n=25 trials)</p><p>In summary, to simulate the SI evoked response, a sequence ofexogenous excitatory synaptic drive was simulated (by creatingpresynaptic spikes that activate layer specific synapses in theneocortical network) consisting of proximal drive at ~25 ms, followed bydistal drive at ~60 ms, followed by a second proximal drive at ~122 ms.Given this background information, we can now walk you through the stepsof simulating a similar ERP, using a subset of the data shown in Figure1.</p><h2>Tutorial Table of Contents</h2><p><a href="#1-loadview-data">1. Load/view data</a></p><p><ahref="#2-loadview-parameters-to-define-network-structure---to-activate-the-network">2.Load/view parameters to define network structure &amp; to “activate” thenetwork</a></p><p><ahref="#3-running-the-simulation-and-visualizing-net-current-dipole">3.Running the simulation and visualizing net current dipole</a></p><p><ahref="#4-a-closer-look-inside-the-simulations-contribution-of-layers-and-cell-types">4.A closer look inside the simulations: contribution of layers and celltypes</a></p><p><a href="#5-comparing-model-output-and-recorded-data">5. Comparingmodel output and recorded data</a></p><p><a id="toc_1"></a></p><h2>1. Load/view data</h2><p>An example ERP dataset is provided in the<a href="https://github.com/jonescompneurolab/hnn-data">hnn-data GitHubrepository</a>. We use the data as an orienting example for where tobegin to simulate an ERP.</p><p>This dataset represents early evoked activity (0-175 ms) from anequivalent current dipole source localized to the hand area of theprimary somatosensory cortex (SI), elicited by a brief perceptualthreshold level tap to the contralateral D3 digit (read Getting Startedabove for details). The example dataset provided was collected at 600Hzand contains only averaged data from 100 trials in which the tap wasdetected. (Note, when loading your own data, if it was not collected at600Hz, you must first downsample to 600Hz to view it in the HNNGUI).</p><p>To load and view this data, navigate to the main GUI window and onthe bottom left corner click: <code>Load data</code></p><p>If you have cloned the hnn-data repository, navigate to hnn-datafolder on your desktop and select<code>MEG_detection_data/yes_trial_S1_ERP_all_avg.txt</code>. HNN willthen load the data and display the waveform in the dipole window asshown below.</p><p>Alternatively, if you have not cloned the hnn-data repository, youcan download the file directly by clicking<a href="https://github.com/jonescompneurolab/hnn/blob/master/data/MEG_detection_data/yes_trial_S1_ERP_all_avg.txt">here</a>.</p><section style="display:block; width:90%; margin: 0 auto;"><h3>Figure 2</h3><p><img src="images/erp_fig_02.gif" /></p></section><p>Note, the software can be used without loading data. If you wish toplay with simulations without data, proceed to Step 2 first.</p><p><a id="toc_2"></a></p><h2>2. Load/view parameters to define network structure &amp; to“activate” the network</h2><p>An initial parameter set that will simulate the evoked drives thatgenerate an evoked response in close agreement with the SI datadescribed in Step 1 is distributed in the hnn-data repository. Click onthe <code>External drives</code> tab at the top of the GUI and thenclick the <code>Load external drives</code> button. Navigate to the<code>hnn-data/network-configurations</code> folder on your computer andselect <code>ERPYes100Trials.json</code>, or<a href="https://github.com/jonescompneurolab/hnn/tree/master/param">downloadthe parameter file</a> and load it into the GUI.</p><section style="display:block; width:90%; margin: 0 auto;"><h3>Figure 3</h3><p><img src="images/erp_fig_03.gif" /></p></section><p>The template cortical column networks structure for this simulationis described in the <a href="https://hnn.brown.edu/under-the-hood/">“HNNTemplate Model” page</a> on the hnn.brown.edu website. Several of thenetwork parameter can be adjusted via the HNN GUI (e.g., localexcitatory and inhibitory connection strengths) under the<code>Network connectivity</code> tab, but we will leave them fixed forthis tutorial and only adjust the inputs that “activate” thenetwork.</p><p>The values of the parameters that you loaded to “activate” thenetwork in a manner that will generate an evoked response can now beviewed under the <code>External drives</code> tab. As described in the“Getting Started” section, the evoked response can be simulated with asequence of exogenous driving inputs consisting of a proximal input at~26 ms (evprox1), followed by a distal input at ~64 ms (evdist1),followed by a subsequent proximal input at ~137 ms (evprox).</p><p>To see the detailed parameter values defining each of these drivesclick on the dropdown button next to the name of each drive. Note:additional evoked proximal or distal inputs can be added to yoursimulation for your hypothesis testing goals by using the<code>Add drive</code> button and specifying the drive as “Evoked” andthe location as either “proximal” or “distal”. Other types of drives canalso be defined including poisson, rhythmic, and tonic, as detailed inother tutorials.</p><section style="display:block; width:90%; margin: 0 auto;"><h3>Figure 4</h3><p><img src="images/erp_fig_04.png" /></p></section><!-- <div class="stylefig"><table><h3>Figure 4</h3><tr><td><div style="max-width:500px;">![Figure 4a](images/erp_fig_04_01.png)</div></td><td><div style="max-width:500px;">![Figure 4a](images/erp_fig_04_02.png)</div></td></tr></table></div> --><p>Each evoked input consists of a Gaussian distributed train ofpresynaptic action potentials that will target all of the cells in thepost-synaptic network, with several adjustable parameters, including themean arrival and standard deviation of the time each spike activates thenetwork (in milliseconds), the number of the driving spikes on eachtrial of the simulation, and a random number seed that enablesreproducibility of simulation results across trials. You can also adjustthe postsynaptic conductance of the drive onto the postsynaptic cell.For example, under the “AMPA weights” section in the “evprox1” dropdownmenu, the L5_pyramidal field represents the the post synaptic AMPAconductance of the proximal input onto the layer 5 pyramidal neuron ateach location targeted by the proximal drive. For further details on theconnectivity structure of the network, see the<a href="https://hnn.brown.edu/under-the-hood/">“HNN Template Model”</a>page.</p><p><a id="toc_3"></a></p><h2>3. Running the simulation and visualizing net current dipole</h2><p>Now that we have an initial parameter set, we can run a simulationfor a set number or trials. Let’s start by defining 3 trials, byclicking on the <code>Simulation</code> tab and defining Trials=3. Oneach simulated trial, the timings of the evoked inputs (i.e., spikes)are chosen from a Gaussian distribution with mean and stdev (standarddeviation) as defined in the “Evoked drives” tap. Histograms of each ofthe evoked inputs will be displayed at the top of the Figure tab afterthe simulations run.</p><p>Before running the simulation, we’ll first change the simulation name(i.e., the name under which the simulated data will be saved) to a newdescriptive-name for the simulation here. Under the<code>Simulation</code> tab, change the name from “default” to“ERPyes-3trials”. (Note that the default simulation is in fact 1 run ofthe “ERPyes” simulation.) There are several other adjustable simulateparameters in the <code>Simulation</code> tab. These parameters controlthe duration (stop), integration time step (dt), number of trials(Trials), and the choice of the simulation backend of either MPI(parallel across neurons) or Joblib (parallel across trials), assumingboth backends are installed.</p><p>Hit the <code>Run</code> button to run the simulation. A simulationlog is shown under the Run button that will tell you the status of yoursimulaion.</p><section style="display:block; width:90%; margin: 0 auto;"><h3>Figure 5</h3><p><img src="images/erp_fig_05.png" /></p></section><p>Once complete, a new Figure 2 window will appear showing the outputof the simulation as in the figure below. The thin blue traces are netcurrent dipole signals from individual trials while the thick blue traceis the average ERP, with histograms of the proximal and distal drivingspikes shown above.</p><p>Next, let’s create a new figure to view the simulation on top of theloaded data. Click on the <code>Visualization</code> tab and select the<code>[blank] 2row x 1col (1:3)</code> option from the<code>Layout template</code> dropdown menu, then select<code>Make figure</code>.</p><p>You will see that our new figure has two subplots defined by ax0 andax1, both of which are blank. Select the ax1 subplot and set the<code>Simution Data</code> to <code>ERPyes-3trials</code>. Set<code>Data to compare</code> to <code>yes_trial_S1_ERP_all_avg</code>,then click <code>Add plot</code>.</p><p>Next, select ax0, set the <code>Type</code> to<code>input histogram</code>, and click <code>Add plot</code>.</p><p>Note you can change what is shown in either of these subplots byselecting <code>clear axis</code>, picking the <code>Type</code> of datafrom the pulldown menu, and clicking <code>Add plot</code>.</p><section style="display:block; width:90%; margin: 0 auto;"><h3>Figure 6</h3><p><img src="images/erp_fig_06.gif" /></p></section><p>Importantly, note that a scaling factor of 3000.00 was multiplied bythe net dipole produced by the model, as seen on the y-axis scale in thefigure above. This scaling factor can be adjusted to match the magnitudeof the recorded data; the value of 3000 is the default value for theloaded parameter set. In this case, since the template model contains200 pyramidal neurons (PNs), the simulation predicts that the number ofcells that contribute to the signal is 600,000 (200 x 3000) PNs.</p><p>Also note that in the ERP simulation shown, the raw dipole signal wassmoothed using a Hamming filter using a window size of 30 milliseconds,in order to reduce noise in the ERP signal generated by this reducednetwork model. The level of smoothing can be adjusted by changing thevalue of the Dipole Smooth Window (ms). The longer the window, the moresmoothing will occur. To turn off smoothing entirely, set the windowsize to 0. Below, we provide an example of the same simulation withsmoothing turned off entirely. Note the higher-frequency contentcompared to the ERP simulation with smoothing turned on.</p><section style="display:block; width:90%; margin: 0 auto;"><h3>Figure 7</h3><p><img src="images/erp_fig_07.png" /></p></section><h2>4. A closer look inside the simulations: contribution of layers andcell types</h2><p>One of the main advantages of simulating neocortical activity is thatwe can dive into the details of the simulation to investigate thecontribution of different components in the network; e.g., layers, celltypes, etc. HNN currently enables the viewing of the following:</p><ol type="1"><li>Layer-specific dipole activity</li><li>Spiking activity in each individual neuron population</li></ol><p><strong>4.1 Viewing layer specific current dipoles</strong></p><p>From the <code>Visualization</code> tab, select “Dipole Layers (3x1)”from the <code>Layout template</code> dropdown menu. From the<code>Dataset</code> dropdown, select the simulation data you would liketo visualize. Next, click <code>Make figure</code> to generate a newfigure.</p><section style="display:block; width:90%; margin: 0 auto;"><h3>Figure 8</h3><p><img src="images/erp_fig_08.png" /></p></section><p>The new figure shows the dipole contributions from Layer 2/3 (top),Layer 5 (middle), and the aggregate (bottom). Note the differentfeatures in Layer 2/3 vs Layer 5 dipole signals, allowing you to teaseapart how the different cortical layers contribute to different netwaveform features. In this figure, the light blue traces are fromindividual trials (n=2), and the dark blue trace is the average acrosstrials. The same dipole scaling factor (3000.0) is applied.</p><p><strong>4.2 Viewing network spiking activity</strong></p><p>From the <code>Visualization</code> tab, select “Drive-Spikes (2x1)”from the <code>Layout template</code> dropdown menu. From the<code>Dataset</code> dropdown, select the simulation data you would liketo visualize. Next, click <code>Make figure</code> to generate a newfigure.</p><section style="display:block; width:90%; margin: 0 auto;"><h3>Figure 9</h3><p><img src="images/erp_fig_09.png" /></p></section><p>This window shows the spiking activity produced in each population inresponse to the evoked inputs. The top two panels show histograms ofdistal evoked inputs (green) and proximal evoked inputs (red) providedto the neurons. The large third panel shows a raster plot of the spikingactivity generated by the individual neurons, with different populationsin different colors as labeled (x-axis: time in ms; y-axis: neuronidentifier). The neuron identifiers are arranged vertically by layer,with top representing supragranular layers and the bottom representingthe infragranular layers. Individual neuron types are drawn in thedifferent colors shown in the legend. The dotted lines in the bottompanel show a time-series of summed activity per population (these usethe same color code as the individual spikes; you can turn these linesoff or on by selecting View&gt; Toggle Histograms). The initial viewshows the aggregate spiking activity across trials. To see spikingactivity generated by a single trial, select the trial number using thecombination box at the bottom of the window. This spike viewer windowalso provides the standard save/navigation functionality through thematplotlib control at the top.</p><p><strong>4.3 Viewing ERP Spectrograms</strong></p><p>HNN also allows you to generate a time-frequency representation ofERP dipole signals.</p><section style="display:block; width:90%; margin: 0 auto;"><h3>Figure 10 spectrogram</h3><p><img src="images/erp_fig_10.png" /></p></section><h2>5. Comparing model output and recorded data</h2><p>When loading data, the root-mean-squared-error (RMSE) is calculatebetween the average simulated ERP waveform and the loaded waveform. Our<code>ERPyes-3trial</code> simulation yields an RMSE of 5.51.</p><p>Let’s run a simulation with 10 trials and see how the RMSEchanges.</p><p>Notice that when we simulated more trials, the RMSE between the dataand the simulated average ERP changed to 5.59. Depending on the numberof trials you run and what adjustments you make to the parameter values,you may be able to reduce the RMSE.</p><section style="display:block; width:90%; margin: 0 auto;"><h3>Figure 11</h3><p><img src="images/erp_fig_11.png" /></p></section><h2>6. Adjusting parameters</h2><p>Parameter adjustments will be key to developing and testinghypotheses on the circuit origin of your own ERP data. HNN is designedso that many of parameters in the model can be adjusted from the GUI(see Tour of the GUI). Here, we’ll walk through examples of how toadjust several “External drives” parameters to investigate how theyimpact the evoked response.</p><p><strong>6.1 Changing the synchrony of the evoked inputs</strong></p><p>In the example evoked response simulation described in Step 3, thetime that each exogenous driving spike was provided to each cell in thelocal network was chosen independently from a Gaussian distribution, forboth the proximal and distal inputs; this variability in timing createdvariability in the response of each cell in the network. Asynchronousexogenous drive is the default configuration in HNN. HNN also providesthe capability to provide exogenous driving inputs to all cells in thenetwork synchronously (0ms lag); this will reduce variability in timingof evoked inputs, producing a stronger response, and may or may notprovide a better fit to the data.</p><p>To change the evoked inputs to contact the cells in networksynchronously, first change the simulation name something like“ERPYes2TrialsSync” in <code>Simulation</code>. This will save thesimulation data to a file with this new name.</p><p>Then, to provide synchronous exogenous drives to all cells in thenetwork, go to <code>External drives</code> and set the<code>Std dev time</code> for all drives to 0.</p><section style="display:block; width:90%; margin: 0 auto;"><h3>Figure 12</h3><p><img src="images/erp_fig_12.png" /></p></section><p>After the simulation has completed, you’ll see the following output.Although the model replicates some gross features of the experimentaldata, the fit to the data is now substantially worse (RMSE = 14.15).Notice also that there is significantly lower variability of the inputtimes in the histograms at the top of the figure (compare to evokedresponse inputs shown in Step 5), predicting (in this case) the evokedresponses are more likely to be non-synchronous. Remember, however, thatthis simulation is only based on two trials.</p><section style="display:block; width:90%; margin: 0 auto;"><h3>Figure 13</h3><p><img src="images/erp_fig_13.png" /></p></section><p><strong>6.1.1 Exercises for further exploration</strong></p><p>Try adjusting the following. How do they affect the simulation? -Standard deviation and AMPA weights in <code>External drives</code> -Data Diople Scaling in <code>Visualization</code> - Dipole Smooth Windowin <code>Visualization</code></p><!-- **6.2 Changing the timing and strength (post-synaptic conductance) of the evoked inputs**For this part of the tutorial, we’ll load a different experimental data set into the GUI. The new experimental data represents the evoked response from non-detected threshold level stimuli in the experiment described in the “Getting Started” section above [1]. We will adjust the parameters to better fit our simulation to the non-detected threshold level data.First, let's load the data from the non-detected trials `no_trial_S1_ERP_all_avg.json`.Notice that the timing and magnitude of the peaks in this new data set are quite different from the evoked responses that were detected.HNN will automatically recalculate the model fit to the data (i.e, the RMSE between the average model response and the loaded data) based on the prior simulations (Step 6.1), showing that the previously used parameter set gave a poor fit to the new data (RMSE = 30.83).<div style="display:block; width:90%; margin: 0 auto;">### Figure 14  ![](images/erp_fig_14.png)</div>Notice that the magnitudes of the peaks in the model are larger than the data, and the timing of the peaks is faster.What might account for these differences between our simulation and the data for the nondetected trials? We can formulate some hypotheses and use HNN to test it. Given the timing and magnitude differences we see in the plot, it is reasonable to hypothesize that these difference can be accounted by 1. A decrease in the strength of the inputs that created the evoked response, and2. A delay in the arrival time of these inputs to the network. To test these hypotheses, we’ll adjust the parameters as described. For simplicity, we have created a parameter file, which accounts for such changes and accurately reproduces the new data. Let's load the `ERPNo100Trials.json` file into `External Drives`.You should see the new values in the dropdowns.<div style="display:block; width:90%; margin: 0 auto;">### Figure 15 ![](images/erp_fig_15.png)</div>Let's take a closer look at what parameters we changed. Notice that in a given layer, weights (post-synaptic conductances) of the evoked inputs to pyramidal neurons, relative to the weights of the interneurons, are generally smaller than they were in the previous simulations. By decreasing the weights of the evoked inputs to pyramidal neurons (and sometimes increasing the weights of the interneurons), we are decreasing the strength of the overall inputs, thereby testing our first hypothesis. Also, notice that the mean input times are larger for all inputs, and the variances has increased for the Proximal 2 input. This means that we are overall delaying the input arrival times to the network, thereby testing the second part of our hypothesis. <div style="display:block; width:90%; margin: 0 auto;">### Figure 16 new param values vs. old param values. Highlight the old para values and compare them side-by-side![](images/erp_fig_16.png)</div>Let’s reduce the number of trials to 2 for speed, change the simulation name, and run the simulation! This simulation should tell us how well our adjusted parameters fit the new non-detected data. <div style="display:block; width:90%; margin: 0 auto;">### Figure 17 simulation result (joyce: the simulation doesn't seem to fit very well?)![](images/erp_fig_17_no_trials_simulation.png)</div>With our new parameter set, the simulation is now a better fit to the experimental data (RMSE = ___). We can interprete these results as supporting our hypothesis that on non-detected trials, the feedback (distal 1) and late-feedforward (proximal 2) inputs to the network are more delayed, less synchronous, and overall weaker than on detected trials. --><p><strong>6.2 Simulating the Suprathreshold response</strong></p><p>For this part of the tutorial, we’ll load a different experimentaldata set into the GUI. The new experimental data represents the evokedresponse from supra-threshold level stimuli in the experiment. We willadjust the parameters to better fit our simulation to the supra-detectedthreshold level data.</p><p>First, let’s load the data from the supra-threshold detected trials<code>S1_SupraT.txt</code> and the data from the threshold-leveldetected trials <code>yes_trial_S1_ERP_all_avg</code>.</p><section style="display:block; width:90%; margin: 0 auto;"><h3>Figure 18</h3><p><img src="images/erp_fig_18.png" /></p></section><p>Notice that the two waveforms displayed have very different features,including altered timing, amplitude, and sharpness of the peaks in thisnew data set.</p><p>If we also load in the previous simulation of threshold-leveldetected trials, <code>ERP_yes_3trials</code>, we can see that HNNautomatically calculate the model fit to both datasets loaded (i.e, theRMSE between the average model response and the loaded data) based onthe threshold-level simulation, showing that<code>ERPYes100Trials.json</code> gives a poor fit to thesupra-threshold data (RMSE = 30.31).</p><section style="display:block; width:90%; margin: 0 auto;"><h3>Figure 19</h3><p><img src="images/erp_fig_19.png" /></p></section><p>What might account for these differences between our simulation andthe data for the supra-threshold detected trials? We can formulate somehypotheses and use HNN to test it.</p><p>Given the timing and magnitude differences we see in the plot, we canhypothesize that these difference can be accounted by 1. An increase inthe strength of the inputs that created the evoked response, and 2. Areduction in the delay in the arrival time of the inputs to thenetwork.</p><p>To test these hypotheses, we’ll adjust the parameters as described.For simplicity, we have also created a parameter file that accounts forsuch changes and accurately reproduces the new data. Load the<code>ERPYesSuparT.json</code> file into<code>External Drives</code>.</p><p>You should see the new values in the dropdowns.</p><p>Next, let’s run the simulation using the <code>Run</code> button.</p><section style="display:block; width:90%; margin: 0 auto;"><h3>Figure 20</h3><p><img src="images/erp_fig_20.png" /></p></section><p>Let’s take a look at the output. First, note that the previousthreshold-level simulation was not removed to allow comparison to thenew supra-threshold simulation. For the new suprathreshold detectionparameter set, there is now a better fit to the experimental data (RMSE= 24.39), with all major waveform features in the experiment andsimulation in agreement. One interpretation of these results is that onsupra-threshold detected trials, both the feedforward and feedbackinputs are stronger, and both early and late feedforward inputs arriveearlier. These trials have overall stronger inputs, which then promotestactile detection.</p><p><strong>6.2.2 Exercises for further exploration</strong></p><ul><li>Run 5 trials using the parameters from above. How does that impactthe RMSE?</li><li>Try manually adjusting the parameters to further reduce theRMSE.</li><li>Try running the simulation for longer and adding an additionalproximal or distal drive; how does this affect the simulation?</li></ul><h2>7. Have fun exploring your own data!</h2><p>Follow steps 1-6 above using your data and parameter adjustmentsbased on your own hypotheses.</p><h2>8. Additional documents</h2><p><strong>8.1 Parameter files</strong> All parameter files for thistutorial can be found by clicking here or by visiting the following URL:https://github.com/jonescompneurolab/hnn/tree/master/param.</p><p><strong>8.2 Video walkthrough</strong> A video walkthrough of anabridged version of the tutorial can be found by clicking here.</p><h2>References</h2><p>Jones, S. R., Pritchett, D. L., Stufflebeam, S. M., Hämäläinen, M.&amp; Moore, C. I. Neural correlates of tactile detection: a combinedmagnetoencephalography and biophysically based computational modelingstudy. J. Neurosci. 27, 10751–10764 (2007).</p><p>Cauller, L. J. &amp; Kulics, A. T. The neural basis of thebehaviorally relevant N1 component of the somatosensory-evoked potentialin SI cortex of awake monkeys: evidence that backward corticalprojections signal conscious touch sensation. Exp. Brain Res. 84,607–619 (1991).</p>    </div> <!-- close content wrapper -->
    </div> <!-- close content -->
</div> <!-- close main -->

<script>
    let isSidebarOpen = true; // Sidebar is initially open

    function toggleNav() {
        const sidebar = document.getElementById("mySidebar");
        const main = document.getElementById("main");

        // Toggle sidebar state
        if (isSidebarOpen) {
            sidebar.style.width = "0";
            main.style.marginLeft = "0";
        } else {
            sidebar.style.width = "350px";  // Adjust width as needed
            main.style.marginLeft = "350px";  // Match margin to new width
        }

        // Toggle the sidebar state
        isSidebarOpen = !isSidebarOpen;
    }

    // Open the sidebar on page load
    window.onload = function() {
        // Set initial styles for open state without animation
        const sidebar = document.getElementById("mySidebar");
        const main = document.getElementById("main");

        sidebar.style.transition = "none";
        main.style.transition = "none";
        sidebar.style.width = "350px";
        main.style.marginLeft = "350px";

        // Re-enable transition for subsequent toggles
        setTimeout(() => {
            sidebar.style.transition = "width 0.5s";
            main.style.transition = "margin-left 0.5s";
        }, 10);
    }

    function increaseFontSize() {
        event.stopPropagation();  // Prevent dropdown from closing
        const content = document.getElementById("content");
        const currentSize = window.getComputedStyle(content).fontSize;
        content.style.fontSize = (parseFloat(currentSize) + 2) + "px";
    }

    function decreaseFontSize() {
        event.stopPropagation();  // Prevent dropdown from closing
        const content = document.getElementById("content");
        const currentSize = window.getComputedStyle(content).fontSize;
        content.style.fontSize = (parseFloat(currentSize) - 2) + "px";
    }

    // Dropdown for font buttons
    function toggleDropdown() {
        const dropdownContent = document.querySelector('.dropdown-content');
        dropdownContent.style.display = dropdownContent.style.display === 'block' ? 'none' : 'block';
    }

    // Open/close dropdown on click of the button
    document.getElementById('dropdownButton').onclick = function(event) {
        event.stopPropagation();  // Prevent the click from triggering the window.onclick event
        toggleDropdown();
    };

    // Close dropdown if clicking outside
    window.onclick = function(event) {
        const dropdownContent = document.querySelector('.dropdown-content');
        if (!event.target.closest('.dropdown')) {  // Close if click outside the dropdown
            dropdownContent.style.display = 'none';
        }
    };

    function toggleSubmenu(event) {
        const header = event.target.closest('#sidebar-header'); // Get the clicked header
        const submenu = header.nextElementSibling; // Get the submenu
        const toggleIcon = header.querySelector('.toggle-icon'); // Get the icon

        if (submenu && submenu.classList.contains('submenu')) {
            submenu.classList.toggle('open'); // Toggle the 'open' class to control visibility
            toggleIcon.textContent = submenu.classList.contains('open') ? '-' : '+'; // Update icon
        }
    }

    // This function will update the sidebar links when a page is loaded
    // locally so that sidebar naivagation remains functional without the
    // need for a server
    // Note: This should work for Mac/Linux but may not on Windows
    document.addEventListener("DOMContentLoaded", function() {
        if (window.location.protocol === "file:") {
            // get the current local directory path
            const currentDir = window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/'));

            // get 'absolute' links with root of 'website_redesign'
            const links = document.querySelectorAll("#mySidebar a");
            links.forEach(link => {
                const href = link.getAttribute("href");

                if (href && href.startsWith("/")) {
                    // extract the local root directory
                    const rootPath = currentDir.split("/website_redesign/")[0];
                    // prepend root path to link
                    const resolvedHref = "file://" + rootPath + href;
                    link.setAttribute("href", resolvedHref);
                }
            });

            // Update image sources for icons
            const images = document.querySelectorAll(".social-icons img, .menu-icons img");
            images.forEach(img => {
                const src = img.getAttribute("src");

                if (src && src.startsWith("/")) {
                    // extract the local root directory
                    const rootPath = currentDir.split("/website_redesign/")[0];
                    // prepend root path to image source
                    const resolvedSrc = "file://" + rootPath + src;
                    img.setAttribute("src", resolvedSrc);
                }
            });
        }
    });

    // Toggle between light and dark themes
    // ----------------------------------------
    // Wait for the DOM to be fully loaded
    document.addEventListener('DOMContentLoaded', () => {
        const themeToggle = document.querySelector('.theme-toggle');
        const sidebar = document.querySelector('.sidebar');
        const sunSVG = `
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                <path d="M361.5 1.2c5 2.1 8.6 6.6 9.6 11.9L391 121l107.9 19.8c5.3 1 9.8 4.6 11.9 9.6s1.5 10.7-1.6 15.2L446.9 256l62.3 90.3c3.1 4.5 3.7 10.2 1.6 15.2s-6.6 8.6-11.9 9.6L391 391 371.1 498.9c-1 5.3-4.6 9.8-9.6 11.9s-10.7 1.5-15.2-1.6L256 446.9l-90.3 62.3c-4.5 3.1-10.2 3.7-15.2 1.6s-8.6-6.6-9.6-11.9L121 391 13.1 371.1c-5.3-1-9.8-4.6-11.9-9.6s-1.5-10.7 1.6-15.2L65.1 256 2.8 165.7c-3.1-4.5-3.7-10.2-1.6-15.2s6.6-8.6 11.9-9.6L121 121 140.9 13.1c1-5.3 4.6-9.8 9.6-11.9s10.7-1.5 15.2 1.6L256 65.1 346.3 2.8c4.5-3.1 10.2-3.7 15.2-1.6zM160 256a96 96 0 1 1 192 0 96 96 0 1 1 -192 0zm224 0a128 128 0 1 0 -256 0 128 128 0 1 0 256 0z"></path>
            </svg>
        `;
        const moonSVG = `
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">
                <path d="M223.5 32C100 32 0 132.3 0 256S100 480 223.5 480c60.6 0 115.5-24.2 155.8-63.4c5-4.9 6.3-12.5 3.1-18.7s-10.1-9.7-17-8.5c-9.8 1.7-19.8 2.6-30.1 2.6c-96.9 0-175.5-78.8-175.5-176c0-65.8 36-123.1 89.3-153.3c6.1-3.5 9.2-10.5 7.7-17.3s-7.3-11.9-14.3-12.5c-6.3-.5-12.6-.8-19-.8z"></path>
            </svg>
        `;

        // Check the saved theme preference
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            document.body.classList.toggle('dark-mode', savedTheme === 'dark');
            themeToggle.innerHTML = savedTheme === 'dark' ? moonSVG : sunSVG;
            sidebar.classList.toggle('dark-mode', savedTheme === 'dark');
        } else {
            // Default to light theme if no saved preference
            themeToggle.innerHTML = sunSVG;
        }

        // Add click event to toggle theme
        themeToggle.addEventListener('click', () => {
            const isDarkMode = document.body.classList.toggle('dark-mode');
            themeToggle.innerHTML = isDarkMode ? moonSVG : sunSVG;
            sidebar.classList.toggle('dark-mode', isDarkMode);
            localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
        });
    });

    // -------------------------------
    // Custom tooltips for the sidebar
    // -------------------------------

    // Flag to track tooltip visibility
    let isTooltipVisible = false;

    // Add text to the 'sidebar-tooltip' attribute for sidebar anchor tags
    document.querySelectorAll('.sidebar a').forEach(anchor => {
        const cleanedText = anchor.textContent.replace(/[+\-]/g, '').trim();
        anchor.setAttribute('sidebar-tooltip', cleanedText);
    });

    // Handle sidebar tooltips
    document.querySelectorAll('.sidebar a').forEach(function(link) {
        link.addEventListener('mouseenter', function(event) {
            const tooltipText = event.target.getAttribute('sidebar-tooltip');
            
            if (!tooltipText || isTooltipVisible) return; // Only show tooltip if none is visible

            // Check if the text is overflowing
            if (event.target.scrollWidth > event.target.offsetWidth) {
                const delay = 500; // Set the delay time (in ms), adjust as needed

                // Create the tooltip after the delay
                setTimeout(function() {
                    // Remove any existing tooltips
                    const existingTooltip = document.querySelector('.sidebar-tooltip');
                    if (existingTooltip) {
                        existingTooltip.remove();
                    }

                    // Create the tooltip element dynamically
                    const tooltip = document.createElement('div');
                    tooltip.classList.add('sidebar-tooltip');  // Use the existing class
                    tooltip.innerText = tooltipText;

                    // Append the tooltip to the body (outside sidebar)
                    document.body.appendChild(tooltip);

                    // Get the position of the link
                    const rect = event.target.getBoundingClientRect();
                    
                    // Position the tooltip based on the link's position
                    tooltip.style.position = 'absolute';
                    tooltip.style.left = `${rect.left + window.scrollX + 20}px`;
                    tooltip.style.top = `${rect.bottom + window.scrollY}px`;  // Adjust with spacing

                    // Make sure the tooltip is visible
                    tooltip.style.opacity = '1';

                    // Set the flag to true indicating that the tooltip is visible
                    isTooltipVisible = true;
                }, delay); // Delay the tooltip creation
            }
        });

        link.addEventListener('mouseleave', function(event) {
            // Remove the tooltip when the mouse leaves
            const tooltip = document.querySelector('.sidebar-tooltip');
            if (tooltip) {
                tooltip.remove();
            }

            // Reset the flag to false when the tooltip is removed
            isTooltipVisible = false;
        });
    });

    // Function to close all open submenus in the navbar
    // --------------------------------------------------
    document.addEventListener("DOMContentLoaded", function() {
        // Function to close all open submenus in the navbar
        function closeAllSubmenus() {
            const allSubmenus = document.querySelectorAll('.submenu.open'); // Select all open submenus
            allSubmenus.forEach(submenu => {
                submenu.classList.remove('open'); // Remove 'open' class to collapse
                const toggleIcon = submenu.previousElementSibling.querySelector('.toggle-icon');
                if (toggleIcon) {
                    toggleIcon.textContent = '+'; // Reset icon to '+'
                }
            });
        }

        // Add functionality to collapse button (SVG icon)
        const collapseIcon = document.querySelector('.collapse-icon');
        if (collapseIcon) {
            collapseIcon.addEventListener('click', function(event) {
                event.stopPropagation(); // Prevent event propagation to avoid unwanted behavior
                closeAllSubmenus(); // Close all open submenus when the icon is clicked
            });
        }
    });

</script>

<!------------------------ #
# Code syntax highlighting #
# ------------------------->
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>

<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />

<script>
    // Remove the leading whitespace/newlines around code blocks 
    // caused by the html structure used for readability
    document.addEventListener("DOMContentLoaded", function() {
        // Select all code blocks
        const codeBlocks = document.querySelectorAll('.code-cell code.language-python');

        codeBlocks.forEach(function(block) {
            // Apply syntax highlighting to the code block
            // Note: The below line is not needed with this setup
            //  but may be useful in the case that the method
            //  is later changed
            // Prism.highlightElement(block);

            // Get the code with highlighted classes
            const highlightedHTML = block.innerHTML;

            // Remove leading/trailing whitespace/newlines
            block.innerHTML = highlightedHTML.trim();
        });

        // Select all output-code blocks
        const outputBlocks = document.querySelectorAll('.output-cell .output-code');

        outputBlocks.forEach(function(block) {
            // Remove unwanted leading/trailing whitespace or newlines
            block.textContent = block.textContent.trim();
        });
    });

    document.addEventListener("DOMContentLoaded", function () {
        const currentPage = window.location.pathname.split("/").pop(); // Get current page filename

        // Find the active link
        const activeLink = document.querySelector(`#mySidebar a[href$='${currentPage}']`);
        if (activeLink) {
            activeLink.classList.add("active"); // Apply the active class

            const submenu = activeLink.closest('.submenu'); // Find the closest submenu
            if (submenu) {
                submenu.classList.add('open'); // Keep the submenu open
                const toggleIcon = submenu.previousElementSibling.querySelector('.toggle-icon');
                if (toggleIcon) {
                    toggleIcon.textContent = '-'; // Ensure the toggle icon reflects the open state
                }
            }
        }
    });

</script>

</body>
</html>